{"version":3,"sources":["../src/list.js"],"names":["define","$","ajax","notification","exportTableToCSV","$table","filename","$rows","find","tmpColDelim","String","fromCharCode","tmpRowDelim","csv","map","i","row","$row","$cols","j","col","$col","text","replace","get","join","split","window","navigator","msSaveBlob","blob","Blob","decodeURIComponent","type","URL","csvUrl","createObjectURL","attr","csvData","encodeURIComponent","init","change","optionaluserelement","alert","optionaluser","val","data","firstuserelement","id","firstuser","eq","html","blankelement","removeAttr","click","restoreid","call","methodname","args","done","remove","fail","exception","apply"],"mappings":"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","sourcesContent":["/**\n * Edit items in feedback module\n *\n * @module     local_remote_backup_provider/list\n * @package    local_remote_backup_provider\n * @copyright  2020 Wunderbyte GmbH\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification'], function ($, ajax, notification) {\n\n    var exportTableToCSV = function ($table, filename) {\n\n        var $rows = $table.find('tr:has(td)'),\n\n            // Temporary delimiter characters unlikely to be typed by keyboard\n            // This is to avoid accidentally splitting the actual contents\n            tmpColDelim = String.fromCharCode(11), // vertical tab character\n            tmpRowDelim = String.fromCharCode(0), // null character\n\n            // actual delimiter characters for CSV format\n            colDelim = '\",\"',\n            rowDelim = '\"\\r\\n\"',\n\n            // Grab text from table into CSV formatted string\n            csv = '\"' + $rows.map(function (i, row) {\n                var $row = $(row),\n                    $cols = $row.find('td.includeincsv');\n\n                return $cols.map(function (j, col) {\n                    var $col = $(col),\n                        text = $col.text();\n\n                    return text.replace(/\"/g, '\"\"'); // escape double quotes\n\n                }).get().join(tmpColDelim);\n\n            }).get().join(tmpRowDelim)\n                .split(tmpRowDelim).join(rowDelim)\n                .split(tmpColDelim).join(colDelim) + '\"';\n\n        if (window.navigator.msSaveBlob) {\n\n            var blob = new Blob([decodeURIComponent(csv)], {\n                type: 'text/csv;charset=utf8'\n            });\n\n            window.navigator.msSaveBlob(blob, filename);\n\n        } else if (window.Blob && window.URL) {\n            // HTML5 Blob\n            var blob = new Blob([csv], {\n                type: 'text/csv;charset=utf-8'\n            });\n            var csvUrl = URL.createObjectURL(blob);\n\n            $(this)\n                .attr({\n                    'download': filename,\n                    'href': csvUrl\n                });\n        } else {\n            // Data URI\n            var csvData = 'data:application/csv;charset=utf-8,' + encodeURIComponent(csv);\n\n            $(this)\n                .attr({\n                    'download': filename,\n                    'href': csvData,\n                    'target': '_blank'\n                });\n        }\n    };\n\n    return {\n        init: function () {\n            //we add listener to dropdown function\n            $(\".rbp_dropdown\").change(function () {\n\n                //collect all the values\n                //var restoreid = $('#tabletoexport').data('restoreid');\n\n                var optionaluserelement = $(this).find('.optionvalue:selected');\n\n                if (optionaluserelement) {\n                    //we only do the work if we selected somebody\n                }\n                else {\n                    alert(\"we drew blank\");\n                }\n                var optionaluser = {\n                    'id':$(this).val(),\n                    'username':optionaluserelement.data('username'),\n                    'firstname':optionaluserelement.data('firstname'),\n                    'lastname':optionaluserelement.data('lastname'),\n                    'useremail':optionaluserelement.data('useremail')\n                };\n\n\n                var firstuserelement = $('#rbp_userrow_'+this.id);\n                var firstuser = {\n                    'id':this.id,\n                    'username':firstuserelement.data('username'),\n                    'firstname':firstuserelement.data('firstname'),\n                    'lastname':firstuserelement.data('lastname'),\n                    'useremail':firstuserelement.data('useremail')\n                };\n\n                //now we change the appearance\n                firstuserelement.find('td').eq(0).html(optionaluser['username']);\n                firstuserelement.find('td').eq(1).html(optionaluser['firstname']);\n                firstuserelement.find('td').eq(2).html(optionaluser['lastname']);\n                firstuserelement.find('td').eq(3).html(optionaluser['useremail']);\n\n                firstuserelement.data('username', optionaluser['username']);\n                firstuserelement.data('firstname', optionaluser['firstname']);\n                firstuserelement.data('lastname', optionaluser['lastname']);\n                firstuserelement.data('useremail', optionaluser['useremail']);\n\n                optionaluserelement.data('username', firstuser['username']);\n                optionaluserelement.data('firstname', firstuser['firstname']);\n                optionaluserelement.data('lastname', firstuser['lastname']);\n                optionaluserelement.data('useremail', firstuser['useremail']);\n\n                optionaluserelement.text(firstuser['username']+\" \"+firstuser['useremail']);\n\n                var blankelement = $(this).find('.blankvalue');\n                blankelement.text('Merged with existing user');\n                blankelement.attr('selected','selected');\n                // We have to remove the selected Attribute right away to make it work more than once\n                blankelement.removeAttr('selected');\n            });\n\n            $(\".rbp_delete\").click(function () {\n\n                var restoreid = $('#tabletoexport').data('restoreid');\n\n                var id = this.id;\n                ajax.call([{\n                    methodname: \"local_remote_backup_provider_delete_user_entry_from_backup\",\n                    args: {'id': this.id, 'restoreid':restoreid},\n                    done: function () {\n                        $('#rbp_userrow_' + id).remove();\n                    },\n                    fail: notification.exception\n                }]);\n            });\n            $('#linktodownload').click(function () {\n\n                var args = [$('#tabletoexport>table'), 'userlist.csv'];\n\n                exportTableToCSV.apply(this, args);\n            });\n        },\n    };\n});"],"file":"list.min.js"}