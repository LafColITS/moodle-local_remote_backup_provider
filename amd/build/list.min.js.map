{"version":3,"sources":["../src/list.js"],"names":["define","$","ajax","notification","exportTableToCSV","$table","filename","$rows","find","tmpColDelim","String","fromCharCode","tmpRowDelim","csv","map","i","row","$row","$cols","j","col","$col","text","replace","get","join","split","window","navigator","msSaveBlob","blob","Blob","decodeURIComponent","type","URL","csvUrl","createObjectURL","attr","csvData","encodeURIComponent","init","change","optionaluserelement","firstuserelement","id","restoreid","data","optionaluser","val","firstuser","call","methodname","args","done","eq","html","fail","exception","click","remove","coursename","apply","restorelink","location"],"mappings":"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","sourcesContent":["/**\n * Edit items in feedback module\n *\n * @module     local_remote_backup_provider/list\n * @package    local_remote_backup_provider\n * @copyright  2020 Wunderbyte GmbH\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification'], function ($, ajax, notification) {\n    var exportTableToCSV = function ($table, filename) {\n\n        var $rows = $table.find('tr:has(td)'),\n\n            // Temporary delimiter characters unlikely to be typed by keyboard\n            // This is to avoid accidentally splitting the actual contents\n            tmpColDelim = String.fromCharCode(11), // vertical tab character\n            tmpRowDelim = String.fromCharCode(0), // null character\n\n            // actual delimiter characters for CSV format\n            colDelim = '\",\"',\n            rowDelim = '\"\\r\\n\"',\n\n            // Grab text from table into CSV formatted string\n            csv = '\"' + $rows.map(function (i, row) {\n                var $row = $(row),\n                    $cols = $row.find('td.includeincsv');\n\n                return $cols.map(function (j, col) {\n                    var $col = $(col),\n                        text = $col.text();\n\n                    return text.replace(/\"/g, '\"\"'); // escape double quotes\n\n                }).get().join(tmpColDelim);\n\n            }).get().join(tmpRowDelim)\n                .split(tmpRowDelim).join(rowDelim)\n                .split(tmpColDelim).join(colDelim) + '\"';\n\n        if (window.navigator.msSaveBlob) {\n\n            var blob = new Blob([decodeURIComponent(csv)], {\n                type: 'text/csv;charset=utf8'\n            });\n\n            window.navigator.msSaveBlob(blob, filename);\n\n        } else if (window.Blob && window.URL) {\n            // HTML5 Blob\n            var blob = new Blob([csv], {\n                type: 'text/csv;charset=utf-8'\n            });\n            var csvUrl = URL.createObjectURL(blob);\n\n            $(this)\n                .attr({\n                    'download': filename,\n                    'href': csvUrl\n                });\n        } else {\n            // Data URI\n            var csvData = 'data:application/csv;charset=utf-8,' + encodeURIComponent(csv);\n\n            $(this)\n                .attr({\n                    'download': filename,\n                    'href': csvData,\n                    'target': '_blank'\n                });\n        }\n    };\n\n    return {\n        init: function () {\n            //we add listener to dropdown function\n            $(\".rbp_dropdown\").change(function () {\n\n                //collect all the values\n                var optionaluserelement = $(this).find('.optionvalue:selected');\n                var firstuserelement = $('#rbp_userrow_' + this.id);\n                var restoreid = $('#tabletoexport').data('restoreid');\n\n                var optionaluser = {\n                    'id': $(this).val(),\n                    'username': optionaluserelement.data('username'),\n                    'firstname': optionaluserelement.data('firstname'),\n                    'lastname': optionaluserelement.data('lastname'),\n                    'useremail': optionaluserelement.data('useremail')\n                };\n\n                var firstuser = {\n                    'id': this.id,\n                    'username': firstuserelement.data('username'),\n                    'firstname': firstuserelement.data('firstname'),\n                    'lastname': firstuserelement.data('lastname'),\n                    'useremail': firstuserelement.data('useremail')\n                };\n\n                if (!optionaluser['username']) {\n                    // Now we change everything in our users.xml file in our backupt\n                    ajax.call([{\n                        methodname: \"local_remote_backup_provider_update_user_entry_in_backup\",\n                        args: {\n                            'id': this.id,\n                            'restoreid': restoreid,\n                            'username': firstuser['username'],\n                            'firstname': firstuser['firstname'],\n                            'lastname': firstuser['lastname'],\n                            'useremail': firstuser['useremail']\n                        },\n                        done: function () {\n                            //$('#continue').attr(\"href\", link);\n                            firstuserelement.find('td').eq(4).html('create as new user');\n                        },\n                        fail: notification.exception\n                    }]);\n\n                } else {\n                    // Now we change everything in our users.xml file in our backupt\n                    ajax.call([{\n                        methodname: \"local_remote_backup_provider_update_user_entry_in_backup\",\n                        args: {\n                            'id': this.id,\n                            'restoreid': restoreid,\n                            'username': optionaluser['username'],\n                            'firstname': optionaluser['firstname'],\n                            'lastname': optionaluser['lastname'],\n                            'useremail': optionaluser['useremail']\n                        },\n                        done: function () {\n                            //$('#continue').attr(\"href\", link);\n                            firstuserelement.find('td').eq(4).html('merge with existing user');\n                        },\n                        fail: notification.exception\n                    }]);\n                }\n            });\n\n            $(\".rbp_delete\").click(function () {\n\n                var restoreid = $('#tabletoexport').data('restoreid');\n\n                var id = this.id;\n                ajax.call([{\n                    methodname: \"local_remote_backup_provider_delete_user_entry_from_backup\",\n                    args: {'id': this.id, 'restoreid': restoreid},\n                    done: function () {\n                        //$('#continue').attr(\"href\", link);\n                        $('#rbp_userrow_' + id).remove();\n                    },\n                    fail: notification.exception\n                }]);\n            });\n            $('#linktodownload').click(function () {\n\n                //get the coursename for name of csv file\n                var coursename = $('#remote_course_name').text();\n                var args = [$('#tabletoexport>table'), 'userlist_import_'+coursename+'.csv'];\n                exportTableToCSV.apply(this, args);\n            });\n\n            $('#continue').click(function () {\n\n                var restorelink = $('#continue').data('href');\n                var restoreid = $('#tabletoexport').data('restoreid');\n                var link = restorelink+\"&filename=updated_backup.mbz\";\n\n                ajax.call([{\n                    methodname: \"local_remote_backup_provider_create_updated_backup\",\n                    args: {'restoreid': restoreid},\n                    done: function () {\n                        window.location = link;\n                    },\n                    fail: notification.exception\n                }]);\n            });\n        },\n    };\n});"],"file":"list.min.js"}