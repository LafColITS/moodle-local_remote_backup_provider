{"version":3,"sources":["../src/list.js"],"names":["define","$","ajax","notification","exportTableToCSV","$table","filename","$rows","find","tmpColDelim","String","fromCharCode","tmpRowDelim","csv","map","i","row","$row","$cols","j","col","$col","text","replace","get","join","split","window","navigator","msSaveBlob","blob","Blob","decodeURIComponent","type","URL","csvUrl","createObjectURL","attr","csvData","encodeURIComponent","init","change","optionaluserelement","optionaluser","val","data","firstuserelement","id","firstuser","eq","html","blankelement","removeAttr","alert","click","restoreid","link","indexOf","substring","call","methodname","args","done","remove","fail","exception","apply"],"mappings":"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","sourcesContent":["/**\n * Edit items in feedback module\n *\n * @module     local_remote_backup_provider/list\n * @package    local_remote_backup_provider\n * @copyright  2020 Wunderbyte GmbH\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification'], function ($, ajax, notification) {\n    var exportTableToCSV = function ($table, filename) {\n\n        var $rows = $table.find('tr:has(td)'),\n\n            // Temporary delimiter characters unlikely to be typed by keyboard\n            // This is to avoid accidentally splitting the actual contents\n            tmpColDelim = String.fromCharCode(11), // vertical tab character\n            tmpRowDelim = String.fromCharCode(0), // null character\n\n            // actual delimiter characters for CSV format\n            colDelim = '\",\"',\n            rowDelim = '\"\\r\\n\"',\n\n            // Grab text from table into CSV formatted string\n            csv = '\"' + $rows.map(function (i, row) {\n                var $row = $(row),\n                    $cols = $row.find('td.includeincsv');\n\n                return $cols.map(function (j, col) {\n                    var $col = $(col),\n                        text = $col.text();\n\n                    return text.replace(/\"/g, '\"\"'); // escape double quotes\n\n                }).get().join(tmpColDelim);\n\n            }).get().join(tmpRowDelim)\n                .split(tmpRowDelim).join(rowDelim)\n                .split(tmpColDelim).join(colDelim) + '\"';\n\n        if (window.navigator.msSaveBlob) {\n\n            var blob = new Blob([decodeURIComponent(csv)], {\n                type: 'text/csv;charset=utf8'\n            });\n\n            window.navigator.msSaveBlob(blob, filename);\n\n        } else if (window.Blob && window.URL) {\n            // HTML5 Blob\n            var blob = new Blob([csv], {\n                type: 'text/csv;charset=utf-8'\n            });\n            var csvUrl = URL.createObjectURL(blob);\n\n            $(this)\n                .attr({\n                    'download': filename,\n                    'href': csvUrl\n                });\n        } else {\n            // Data URI\n            var csvData = 'data:application/csv;charset=utf-8,' + encodeURIComponent(csv);\n\n            $(this)\n                .attr({\n                    'download': filename,\n                    'href': csvData,\n                    'target': '_blank'\n                });\n        }\n    };\n\n    return {\n        init: function () {\n            //we add listener to dropdown function\n            $(\".rbp_dropdown\").change(function () {\n\n                //collect all the values\n                //var restoreid = $('#tabletoexport').data('restoreid');\n\n                var optionaluserelement = $(this).find('.optionvalue:selected');\n\n                if (optionaluserelement) {\n                    //we only do the work if we selected somebody\n                    var optionaluser = {\n                        'id':$(this).val(),\n                        'username':optionaluserelement.data('username'),\n                        'firstname':optionaluserelement.data('firstname'),\n                        'lastname':optionaluserelement.data('lastname'),\n                        'useremail':optionaluserelement.data('useremail')\n                    };\n\n                    var firstuserelement = $('#rbp_userrow_'+this.id);\n                    var firstuser = {\n                        'id':this.id,\n                        'username':firstuserelement.data('username'),\n                        'firstname':firstuserelement.data('firstname'),\n                        'lastname':firstuserelement.data('lastname'),\n                        'useremail':firstuserelement.data('useremail')\n                    };\n\n                    optionaluserelement.text(firstuser['username']\n                        +\" \"+firstuser['firstname']\n                        +\" \"+firstuser['lastname']\n                        +\" \"+firstuser['useremail']);\n\n                    // Now we change the appearance.\n                    firstuserelement.find('td').eq(0).html(optionaluser['username']);\n                    firstuserelement.find('td').eq(1).html(optionaluser['firstname']);\n                    firstuserelement.find('td').eq(2).html(optionaluser['lastname']);\n                    firstuserelement.find('td').eq(3).html(optionaluser['useremail']);\n\n                    // And now we switch the database.\n                    firstuserelement.data('username', optionaluser['username']);\n                    firstuserelement.data('firstname', optionaluser['firstname']);\n                    firstuserelement.data('lastname', optionaluser['lastname']);\n                    firstuserelement.data('useremail', optionaluser['useremail']);\n\n                    optionaluserelement.data('username', firstuser['username']);\n                    optionaluserelement.data('firstname', firstuser['firstname']);\n                    optionaluserelement.data('lastname', firstuser['lastname']);\n                    optionaluserelement.data('useremail', firstuser['useremail']);\n\n                    var blankelement = $(this).find('.blankvalue');\n                    blankelement.text('Merged with existing user');\n                    blankelement.attr('selected','selected');\n                    // We have to remove the selected Attribute right away to make it work more than once\n                    blankelement.removeAttr('selected');\n                }\n                else {\n                    alert(\"we drew blank\");\n                }\n            });\n\n            $(\".rbp_delete\").click(function () {\n\n                var restoreid = $('#tabletoexport').data('restoreid');\n\n                var link = $('#continue').attr(\"href\");\n                if (link.indexOf(\"&pathnamehash\") != -1) {\n                    link = link.substring(0, link.indexOf(\"&pathnamehash\"));\n                    link = link+\"&filename=updated_backup.mbz\";\n                }\n\n                var id = this.id;\n                ajax.call([{\n                    methodname: \"local_remote_backup_provider_delete_user_entry_from_backup\",\n                    args: {'id': this.id, 'restoreid':restoreid},\n                    done: function () {\n                        $('#continue').attr(\"href\", link);\n                        $('#rbp_userrow_' + id).remove();\n                    },\n                    fail: notification.exception\n                }]);\n            });\n            $('#linktodownload').click(function () {\n\n                var args = [$('#tabletoexport>table'), 'userlist.csv'];\n                exportTableToCSV.apply(this, args);\n            });\n        },\n    };\n});"],"file":"list.min.js"}